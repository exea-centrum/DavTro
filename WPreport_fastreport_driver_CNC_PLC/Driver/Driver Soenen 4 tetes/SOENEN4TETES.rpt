[Record REPORT]
[CODE=SOENEN4TETES]
[C]code=SOENEN4TETES
[M]descriptio=41
dernière modification faite le 20/05/2009
[M]design=12399
<?xml version="1.0" encoding="utf-8"?>
<TfrxReport Version="4.6.5" DotMatrixReport="false" EngineOptions.DoublePass="true" IniFile="\Software\Fast Reports" PreviewOptions.AllowEdit="false" PreviewOptions.Buttons="4089" PreviewOptions.Zoom="1" PrintOptions.Printer="Par défaut" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="39917,5159154977" ReportOptions.Description.Text="" ReportOptions.Name="SOENEN4TETES" ReportOptions.LastChange="39917,5159154977" ScriptLanguage="PascalScript" ScriptText.Text="var&#13;&#10;t : tfilestream;&#13;&#10;chemin, cheminr : string;&#13;&#10;ligne, suite, cprof : string;&#13;&#10;cpt, cptpart : integer;&#13;&#10;xmini, xmaxi, ymini, ymaxi : integer;&#13;&#10;remarque : string;                                                    &#13;&#10;&#13;&#10;// procedure de vérification si besoin de retourner le cadre                                                                                                                                     &#13;&#10;procedure verifdim(d1: integer; d2 : integer);&#13;&#10;var&#13;&#10;tmp : integer;                                  &#13;&#10;begin&#13;&#10;       if (((d1 &#60; xmini) or (d1 &#62; xmaxi)) and ((d1 &#62; ymini) and (d1 &#60; ymaxi)))&#13;&#10;               and (((d2 &#60; ymini) or (d2 &#62; ymaxi)) and ((d2 &#62; xmini) and (d2 &#60; xmaxi))) then&#13;&#10;       begin&#13;&#10;               tmp := d1;&#13;&#10;               d1 := d2;&#13;&#10;               d2 := tmp;&#13;&#10;               remarque := 'Cadre retourne';                                                                              &#13;&#10;       end;&#13;&#10;&#13;&#10;       ligne := ligne + ajcar(inttostr(d1), '0', 5, 2)&#13;&#10;       + ajcar(inttostr(d2), '0', 5, 2);                                                                               &#13;&#10;end;&#13;&#10;  &#13;&#10;//fonction d'ajout de caractères à droite ou à gauche d'une chaine envoyée                                                                                                                                                                                        &#13;&#10;function ajcar(chaine: string; c: string; t: integer; dg : integer) : string;&#13;&#10;//dg = 1 caractère a placer à droite&#13;&#10;//dg = 2 caractère a placer à gauche    &#13;&#10;var&#13;&#10;i : integer;                              &#13;&#10;begin&#13;&#10;       if t &#60; length(chaine) then&#13;&#10;       begin&#13;&#10;               chaine := copy(chaine, length(chaine)-t, length(chaine));                                                                                        &#13;&#10;       end&#13;&#10;       else&#13;&#10;       begin             &#13;&#10;               for i := length(chaine) to t-1 do&#13;&#10;               begin&#13;&#10;                       if dg = 1 then chaine := chaine + c                                                     &#13;&#10;                       else chaine := c + chaine;                                                                                  &#13;&#10;               end;                         &#13;&#10;       end;                 &#13;&#10;       result := chaine;                                               &#13;&#10;end;&#13;&#10;                                             &#13;&#10;begin&#13;&#10;       xmini := inireadinteger('.\soenen4.ini', 'soudage:xmini', '0');&#13;&#10;       ymini := inireadinteger('.\soenen4.ini', 'soudage:ymini', '0');&#13;&#10;       xmaxi := inireadinteger('.\soenen4.ini', 'soudage:xmaxi', '0');&#13;&#10;       ymaxi := inireadinteger('.\soenen4.ini', 'soudage:ymaxi', '0');&#13;&#10;&#13;&#10;       chemin := inireadstring('.\soenen4.ini', 'chemin de base:chemin', '.\');&#13;&#10;       cheminr := inireadstring('.\soenen4.ini', 'chemin reseau:chemin', '.\');&#13;&#10;       forcedirectories(chemin);&#13;&#10;       forcedirectories(cheminr);                                                                      &#13;&#10;         &#13;&#10;       ligne := '';                                   &#13;&#10;       cpt := 1;&#13;&#10;       cptpart := 0;                                       &#13;&#10;       firstrecord('detlot');&#13;&#10;&#13;&#10;       t := tfilestream.create(chemin+trim(&#60;detlot.&#34;lot&#34;&#62;)+'.job', fmcreate);                                    &#13;&#10;         &#13;&#10;       while not queryeof('detlot') do&#13;&#10;       begin&#13;&#10;               if &#60;detlot.&#34;position&#34;&#62; = 1 then&#13;&#10;               begin&#13;&#10;                       if (cptpart &#60;&#62; 1) then&#13;&#10;                       begin                                                                                    &#13;&#10;                               cptpart := 0;                                                                                                                       &#13;&#10;                       end&#13;&#10;                       else&#13;&#10;                       begin&#13;&#10;                               priorrecord('detlot');&#13;&#10;                               if &#60;detlot.&#34;position&#34;&#62; = 4 then&#13;&#10;                               begin                                           &#13;&#10;                                       cprof := ajcar(cprof, ' ', 28, 1);                                                                                                                           &#13;&#10;                                       t.write(ligne+cprof+suite, length(ligne)+length(cprof)+length(suite));&#13;&#10;                                       cptpart := 0;&#13;&#10;                                       inc(cpt,1);&#13;&#10;                               end;&#13;&#10;                               nextrecord('detlot');                                                           &#13;&#10;                                                                  &#13;&#10;                       end;&#13;&#10;                       cprof := '';&#13;&#10;                       suite := '';  &#13;&#10;                       ligne := '';&#13;&#10;                         &#13;&#10;                       ligne := ajcar(inttostr(cpt), '0', 3, 2)&#13;&#10;                       + ajcar(trim(copy(&#60;detlot.&#34;code&#34;&#62;,length(&#60;detlot.&#34;code&#34;&#62;)-6, length(&#60;detlot.&#34;code&#34;&#62;))), ' ', 7, 1)&#13;&#10;                                                  &#13;&#10;                       + ajcar(inttostr(&#60;detlot.&#34;casier&#34;&#62;), '0', 2, 2);&#13;&#10;                 &#13;&#10;                       remarque := '';&#13;&#10;                 &#13;&#10;                       verifdim(&#60;detlot.&#34;dim1&#34;&#62;,&#60;detlot.&#34;dim2&#34;&#62;);                                                       &#13;&#10;&#13;&#10;                       ligne := ligne + ajcar(&#60;detlot.&#34;type&#34;&#62;, ' ', 3, 1);&#13;&#10;&#13;&#10;                       cprof := ajcar(&#60;detlot.&#34;profil&#34;&#62;, ' ', 4, 1)+'/';                                                            &#13;&#10;                         &#13;&#10;                       suite := 'C' + ajcar(trim(&#60;detlot.&#34;lot&#34;&#62;), '0', 5, 2)&#13;&#10;                       + ajcar(remarque, ' ', 30, 1)&#13;&#10;                       + ajcar(&#60;detlot.&#34;codebarre&#34;&#62;, ' ', 14, 1)&#13;&#10;                       + ajcar(inttostr(&#60;detlot.&#34;dim1&#34;&#62;), '0', 5, 2)&#13;&#10;                       + ajcar(inttostr(&#60;detlot.&#34;dim2&#34;&#62;), '0', 5, 2)&#13;&#10;                       + ajcar('1', '0', 11, 2) + chr(13) + chr(10);                                                                               &#13;&#10;                         &#13;&#10;                       inc(cptpart,2);                           &#13;&#10;               end;&#13;&#10;&#13;&#10;               if &#60;detlot.&#34;position&#34;&#62; = 2 then&#13;&#10;               begin&#13;&#10;                       cprof := cprof + ajcar(&#60;detlot.&#34;profil&#34;&#62;, ' ', 4, 1)+'/';                                            &#13;&#10;                       inc(cptpart,1);                                                                                              &#13;&#10;               end;&#13;&#10;                 &#13;&#10;               if &#60;detlot.&#34;position&#34;&#62; = 3 then&#13;&#10;               begin&#13;&#10;                       cprof := cprof + ajcar(&#60;detlot.&#34;profil&#34;&#62;, ' ', 4, 1)+'/';                                            &#13;&#10;                       inc(cptpart,1);                                                                                              &#13;&#10;               end;&#13;&#10;                 &#13;&#10;               if &#60;detlot.&#34;position&#34;&#62; = 4 then&#13;&#10;               begin&#13;&#10;                       cprof := cprof + ajcar(&#60;detlot.&#34;profil&#34;&#62;, ' ', 4, 1);                                            &#13;&#10;                       cptpart := 1;                                                                                              &#13;&#10;               end;&#13;&#10;                 &#13;&#10;               nextrecord('detlot');&#13;&#10;                                                      &#13;&#10;       end;&#13;&#10;         &#13;&#10;       if cptpart= 1 then         &#13;&#10;       begin&#13;&#10;               cprof := ajcar(cprof, ' ', 28, 1);                                                                                                                           &#13;&#10;               t.write(ligne+cprof+suite, length(ligne)+length(cprof)+length(suite));                          &#13;&#10;       end;&#13;&#10;         &#13;&#10;       t.free;&#13;&#10;       if cheminr &#60;&#62; '.\' then copyfile(chemin+trim(&#60;detlot.&#34;lot&#34;&#62;)+'.job', cheminr+trim(&#60;detlot.&#34;lot&#34;&#62;)+'.job');                                                                                             &#13;&#10;end." StoreInDFM="false" PropData="044C65667403D10203546F70031B0108446174617365747301010C2700000020446174615365743D225F6465746C6F742220446174615365744E616D653D226465746C6F74220000095661726961626C657301010C10000000204E616D653D2220436861727365742200010C1E000000204E616D653D22414E53495F43484152534554222056616C75653D22302200010C21000000204E616D653D2244454641554C545F43484152534554222056616C75653D22312200010C20000000204E616D653D2253594D424F4C5F43484152534554222056616C75653D22322200010C1E000000204E616D653D224D41435F43484152534554222056616C75653D2237372200010C23000000204E616D653D2253484946544A495F43484152534554222056616C75653D223132382200010C23000000204E616D653D2248414E4745554C5F43484152534554222056616C75653D223132392200010C22000000204E616D653D2248414E47554C5F43484152534554222056616C75653D223132392200010C21000000204E616D653D224A4F4841425F43484152534554222056616C75653D223133302200010C22000000204E616D653D224742323331325F43484152534554222056616C75653D223133342200010C27000000204E616D653D224348494E455345424947355F43484152534554222056616C75653D223133362200010C21000000204E616D653D22475245454B5F43484152534554222056616C75653D223136312200010C23000000204E616D653D225455524B4953485F43484152534554222056616C75653D223136322200010C26000000204E616D653D22564945544E414D4553455F43484152534554222056616C75653D223136332200010C22000000204E616D653D224845425245575F43484152534554222056616C75653D223137372200010C22000000204E616D653D224152414249435F43484152534554222056616C75653D223137382200010C22000000204E616D653D2242414C5449435F43484152534554222056616C75653D223138362200010C23000000204E616D653D225255535349414E5F43484152534554222056616C75653D223230342200010C20000000204E616D653D22544841495F43484152534554222056616C75653D223232322200010C26000000204E616D653D22454153544555524F50455F43484152534554222056616C75653D223233382200010C1F000000204E616D653D224F454D5F43484152534554222056616C75653D223235352200010C0F000000204E616D653D222057696E50726F2200010C20000000204E616D653D22544F444159222056616C75653D2232302F30352F323030392200010C1C000000204E616D653D224E4F57222056616C75653D2231343A32383A32362200010C15000000204E616D653D22544142222056616C75653D22092200010C25000000204E616D653D22575055534552222056616C75653D2241646D696E697374726174657572220000055374796C650100">
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
</TfrxReport>

[I]fr3=1
[C]title=Driver soudeuse 4 têtes Soenen
[End of REPORT]
[Record REPORTQRY]
[REPORT=SOENEN4TETES      0]
[C]database=db
[C]datasource=%DSN%
[C]name=Database1
[M]params=13
%AUTOLOGIN%

[C]report=SOENEN4TETES
[C]type=D
[I]typedb=9
[End of REPORTQRY]
[Record REPORTQRY]
[REPORT=SOENEN4TETES      1]
[C]database=db
[I]line=1
[C]name=detlot
[M]params=716
select d.lot, d.commande, d.chassis, d.profil, d.casier%50000 as casier, d.position, l.code,
case d.type when 1 then 'D' when 2 then 'O' end as type, d.numero, dt.dim1*10 as dim1, dt.dim2*10 as dim2, p.codebarre, d.instruct, pr.categorie
from detlot d inner join prepalot p on d.lot=p.lot and d.commande=p.commande and d.chassis=p.id
inner join detail dt on d.windowid=dt.windowid
inner join lot l on d.lot=l.lot
inner join profil pr on pr.code=d.profil
where d.lot = :order and d.type in (1,2) and pr.categorie=1
and position in (1,2,3,4) 
and d.instruct='C'
order by d.numero,p.codebarre, d.position, dim1, dim2
/*order by d.lot desc, type desc, d.commande, d.chassis, d.vantail, position ,d.dim1, d.dim2
[C]report=SOENEN4TETES
[C]type=Q
[End of REPORTQRY]
