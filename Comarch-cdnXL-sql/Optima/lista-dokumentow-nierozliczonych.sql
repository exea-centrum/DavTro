SELECT BZd_BZdID, CASE WHEN BZd_NumerObcy<>'' THEN BZd_NumerObcy ELSE (CASE WHEN BZd_NumerPelny<>'' THEN BZd_NumerPelny ELSE BZd_Opis END) END AS exprNumerDok, CASE WHEN BZd_TS_Export Is Not NULL THEN 'E' ELSE '' END AS exprE, BRa_Symbol, CASE WHEN YEAR(BZd_Termin)<2100 THEN BZd_Termin ELSE null END AS exprTermin, CASE BZd_Rozliczono WHEN 1 THEN (CASE WHEN YEAR(cdn.fn_GetWorkingDayAfter(BZd_Termin))<2100 AND DATEDIFF(d, cdn.fn_GetWorkingDayAfter(BZd_Termin), GetDate()) > 0 THEN DATEDIFF(d, cdn.fn_GetWorkingDayAfter(BZd_Termin), GetDate()) ELSE null END) ELSE null END AS exprPoTerminie, CASE WHEN YEAR(BZd_DataReal)<2100 THEN BZd_DataReal ELSE null END AS exprDataReal, Pod_Kod, Pod_Nazwa1 + SPACE(SIGN(LEN(Pod_Nazwa2))) + Pod_Nazwa2 + SPACE(SIGN(LEN(Pod_Nazwa3))) + Pod_Nazwa3 AS exprNazwa, CASE BZd_Kierunek WHEN 1 THEN BZd_KwotaSys ELSE null END AS exprPrzychodSys, CASE BZd_Kierunek WHEN 1 THEN BZd_Kwota ELSE null END AS exprPrzychod, CASE BZd_Kierunek WHEN -1 THEN BZd_KwotaSys ELSE null END AS exprRozchodSys, CASE BZd_Kierunek WHEN -1 THEN BZd_Kwota ELSE null END AS exprRozchod, CASE BZd_Rozliczono WHEN 0 THEN null ELSE CASE BZd_Kierunek WHEN 1 THEN BZd_Kwota-BZd_KwotaRoz ELSE null END END AS exprPrzychodDoRozl, CASE BZd_Rozliczono WHEN 0 THEN null ELSE CASE BZd_Kierunek WHEN 1 THEN BZd_KwotaSys-BZd_KwotaRozSys ELSE null END END AS exprPrzychodDoRozlSys, CASE BZd_Rozliczono WHEN 0 THEN null ELSE CASE BZd_Kierunek WHEN -1 THEN BZd_Kwota-BZd_KwotaRoz ELSE null END END AS exprRozchodDoRozl, CASE BZd_Rozliczono WHEN 0 THEN null ELSE CASE BZd_Kierunek WHEN -1 THEN BZd_KwotaSys-BZd_KwotaRozSys ELSE null END END AS exprRozchodDoRozlSys, CASE WHEN BZd_Waluta<>'' THEN BZd_Waluta ELSE 'PLN' END AS exprWaluta, Kat_KodSzczegol, CASE BZd_Rozliczono WHEN 0 THEN '-'  WHEN 1 THEN (CASE WHEN BZd_KwotaRoz=0 THEN 'N' ELSE 'C' END)  WHEN 2 THEN 'R' ELSE '?' END AS exprRozliczono, CASE BZd_Rozliczono WHEN 1 THEN (CASE WHEN YEAR(BZd_Termin)<2100 AND DATEDIFF(d, BZd_Termin, GetDate()) > 0 THEN DATEDIFF(d, BZd_Termin, GetDate()) ELSE null END) ELSE null END AS exprWindykacjaPoTerminie, BZd_DataReal, BZd_NumerObcy, BZd_NumerPelny, BZd_Kierunek, BZd_Rozliczono2, BZd_BRaID, BRa_Typ, BZd_PodmiotTyp, BZd_PodmiotID, BZd_Rozliczono, BZd_Termin, BZd_DataRoz, BZd_Stan, BZd_DokumentTyp, BZd_DokumentID, BZd_Priorytet, BZd_DataWys AS Usr_Column1, Kat_KontoSegmentMA AS Usr_Column2, Kat_KontoSegmentWN AS Usr_Column3, BRa_KontoPrzeciwstawne AS Usr_Column4, Pod_KontoDost AS Usr_Column5 FROM CDN.BnkZdarzenia A LEFT OUTER JOIN CDN.BnkRachunki B ON A.BZD_Braid = B.BRA_Braid LEFT OUTER JOIN CDN.PodmiotyView C ON (A.BZD_Podmiotid = C.POD_Podid AND A.BZd_PodmiotTyp = C.Pod_PodmiotTyp) LEFT OUTER JOIN CDN.Kategorie D ON A.BZD_Katid = D.KAT_Katid LEFT OUTER JOIN CDN.SchematyWindykacji E ON E.SwN_SwNID = A.BZd_WindykacjaSchematID
WHERE ((((BZd_Rozliczono<>2 AND BZd_Rozliczono<>0) AND (1=1 AND BZd_DokumentTyp<>8))))
ORDER BY BZd_DataReal, BZd_BZdID


lista dokumentów nierozliczonychSELECT DKB_TypDokumentuKB, DKB_DKBID, DKB_Numer, CASE WHEN DKB_Termin Is Not Null AND DKB_Termin < Convert(DATETIME,'2100-01-01 00:00:00',120) THEN DKB_Termin ELSE null END AS TerminWysw, CASE WHEN DKB_TypDokumentuKB = 1 AND DATEDIFF(d, cdn.fn_GetWorkingDayAfter(DKB_Termin), Convert(DATETIME,'2020-05-27 00:00:00',120)) > 0 THEN DATEDIFF(d, cdn.fn_GetWorkingDayAfter(DKB_Termin), Convert(DATETIME,'2020-05-27 00:00:00',120)) ELSE null END AS PoTerminie, DKB_DataDok, Pod_Nazwa1 + SPACE(SIGN(LEN(Pod_Nazwa2))) + Pod_Nazwa2 + SPACE(SIGN(LEN(Pod_Nazwa3))) + Pod_Nazwa3 AS PodmiotNazwa, DKB_Kwota, DKB_Waluta, DKB_KwotaSys, CASE WHEN (DKB_TypDokumentuKB=1 AND DKB_Kierunek=1) OR (DKB_TypDokumentuKB=2 AND DKB_Kierunek=-1) THEN DKB_Kwota - DKB_KwotaRoz ELSE null END AS KwotaNalWysw, CASE WHEN (DKB_TypDokumentuKB=1 AND DKB_Kierunek=1) OR (DKB_TypDokumentuKB=2 AND DKB_Kierunek=-1) THEN DKB_KwotaSys - DKB_KwotaRozSys ELSE null END AS KwotaNalSysWysw, CASE WHEN (DKB_TypDokumentuKB=1 AND DKB_Kierunek=-1) OR (DKB_TypDokumentuKB=2 AND DKB_Kierunek=1) THEN DKB_Kwota - DKB_KwotaRoz ELSE null END AS KwotaZobWysw, CASE WHEN (DKB_TypDokumentuKB=1 AND DKB_Kierunek=-1) OR (DKB_TypDokumentuKB=2 AND DKB_Kierunek=1) THEN DKB_KwotaSys - DKB_KwotaRozSys ELSE null END AS KwotaZobSysWysw, DKB_Opis, Pod_Kod, DKB_Termin, DKB_Numer AS NumerDok, DKB_TypDokumentuKB AS DokTyp, DKB_DKBID AS DokID, DKB_PodmiotTyp AS PodTyp, DKB_PodmiotID AS PodID, Pod_Kod AS PodAkronim, Pod_GlID AS PodGlID, CASE WHEN (DKB_TypDokumentuKB=1 AND DKB_Kierunek*DKB_Kwota<=0) OR (DKB_TypDokumentuKB=2 AND DKB_Kierunek*DKB_Kwota>0) THEN DKB_Kwota - DKB_KwotaRoz ELSE 0 END AS KwotaZob, CASE WHEN (DKB_TypDokumentuKB=1 AND DKB_Kierunek*DKB_Kwota>0) OR (DKB_TypDokumentuKB=2 AND DKB_Kierunek*DKB_Kwota<=0) THEN DKB_Kwota - DKB_KwotaRoz ELSE 0 END AS KwotaNal, DKB_Termin AS Termin, DKB_Rozliczono, DKB_DataRoz, DKB_KwotaRoz, DKB_Kierunek, Pod_KontoDost AS Usr_Column1, Pod_KontoOdb AS Usr_Column2, DKB_KontoPrzeciwstawne AS Usr_Column3 FROM CDN.DokumentyKBView A LEFT OUTER JOIN cdn.PodmiotyView B ON B.Pod_PodmiotTyp = A.DKB_PodmiotTyp AND B.Pod_PodID = A.DKB_PodmiotID
WHERE ((((DKB_Rozliczono = 1 AND (DKB_TypDokumentuKB = 2 OR DKB_Stan>= 1)) AND (((DKB_TypDokumentuKB=1 AND 1=1) OR (DKB_TypDokumentuKB=2 AND 1=1)) AND DKB_PodmiotTyp<>3 AND DKB_PodmiotTyp<>4))))
ORDER BY DKB_Termin
